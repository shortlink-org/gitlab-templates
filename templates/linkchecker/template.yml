spec:
  inputs:
    stage:
      default: test
      description: "Define the stage this job will run in"
    allow_failure:
      default: true
      description: "Whether to allow the job to fail without failing the pipeline"
    tags:
      default: ["gitlab-org-docker"]
      description: "Tags to apply to the job"
---

linkchecker:
  stage: $[[ inputs.stage ]]
  image:
    name: ghcr.io/tcort/markdown-link-check:latest
    entrypoint: ["/bin/sh", "-c"]
  script:
    - find . -name \*.md -print0 | xargs -0 -n1 markdown-link-check -q
  allow_failure: $[[ inputs.allow_failure ]]
  tags: $[[ inputs.tags ]]
  rules:
    - changes:
        - "**/*.md"
    - if: $CI_COMMIT_TAG
      when: on_success
